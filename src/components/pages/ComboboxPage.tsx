import { ComponentShowcase } from "../ui/component-showcase";
import { Check, ChevronsUpDown } from "lucide-react";
import { cn } from "../ui/utils";
import { Button } from "../ui/button";
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
} from "../ui/command";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "../ui/popover";
import { useState } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../ui/card";

const frameworks = [
  { value: "next.js", label: "Next.js" },
  { value: "sveltekit", label: "SvelteKit" },
  { value: "nuxt.js", label: "Nuxt.js" },
  { value: "remix", label: "Remix" },
  { value: "astro", label: "Astro" },
];

export function ComboboxPage() {
  const [open, setOpen] = useState(false);
  const [value, setValue] = useState("");

  return (
    <ComponentShowcase
      title="Combobox"
      description="Autocomplete input and command palette with a list of suggestions."
      category="Forms"
      preview={
        <Popover open={open} onOpenChange={setOpen}>
          <PopoverTrigger asChild>
            <Button
              variant="outline"
              role="combobox"
              aria-expanded={open}
              className="w-[200px] justify-between"
            >
              {value
                ? frameworks.find((framework) => framework.value === value)?.label
                : "Select framework..."}
              <ChevronsUpDown className="ml-2 h-4 w-4 shrink-0 opacity-50" />
            </Button>
          </PopoverTrigger>
          <PopoverContent className="w-[200px] p-0">
            <Command>
              <CommandInput placeholder="Search framework..." />
              <CommandList>
                <CommandEmpty>No framework found.</CommandEmpty>
                <CommandGroup>
                  {frameworks.map((framework) => (
                    <CommandItem
                      key={framework.value}
                      value={framework.value}
                      onSelect={(currentValue) => {
                        setValue(currentValue === value ? "" : currentValue);
                        setOpen(false);
                      }}
                    >
                      <Check
                        className={cn(
                          "mr-2 h-4 w-4",
                          value === framework.value ? "opacity-100" : "opacity-0"
                        )}
                      />
                      {framework.label}
                    </CommandItem>
                  ))}
                </CommandGroup>
              </CommandList>
            </Command>
          </PopoverContent>
        </Popover>
      }
      code={`import * as React from "react"
import { Check, ChevronsUpDown } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
} from "@/components/ui/command"
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/ui/popover"

const frameworks = [
  { value: "next.js", label: "Next.js" },
  { value: "sveltekit", label: "SvelteKit" },
  { value: "nuxt.js", label: "Nuxt.js" },
  { value: "remix", label: "Remix" },
  { value: "astro", label: "Astro" },
]

export function ComboboxDemo() {
  const [open, setOpen] = React.useState(false)
  const [value, setValue] = React.useState("")

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        <Button
          variant="outline"
          role="combobox"
          aria-expanded={open}
          className="w-[200px] justify-between"
        >
          {value
            ? frameworks.find((framework) => framework.value === value)?.label
            : "Select framework..."}
          <ChevronsUpDown className="ml-2 h-4 w-4 shrink-0 opacity-50" />
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-[200px] p-0">
        <Command>
          <CommandInput placeholder="Search framework..." />
          <CommandList>
            <CommandEmpty>No framework found.</CommandEmpty>
            <CommandGroup>
              {frameworks.map((framework) => (
                <CommandItem
                  key={framework.value}
                  value={framework.value}
                  onSelect={(currentValue) => {
                    setValue(currentValue === value ? "" : currentValue)
                    setOpen(false)
                  }}
                >
                  <Check
                    className={cn(
                      "mr-2 h-4 w-4",
                      value === framework.value ? "opacity-100" : "opacity-0"
                    )}
                  />
                  {framework.label}
                </CommandItem>
              ))}
            </CommandGroup>
          </CommandList>
        </Command>
      </PopoverContent>
    </Popover>
  )
}`}
      usage={`// This is a pattern.
// Combine Popover + Command components.`}
      props={[
        {
          name: "Popover Props",
          type: "various",
          default: "-",
          description: "See Popover docs",
        },
        {
          name: "Command Props",
          type: "various",
          default: "-",
          description: "See Command docs",
        }
      ]}
      examples={[]}
      additionalSections={
        <>
          <Card>
            <CardHeader>
              <CardTitle>Propiedades</CardTitle>
              <CardDescription>API completa del componente Combobox</CardDescription>
            </CardHeader>
            <CardContent>
              <table className="w-full">
                <thead>
                  <tr className="border-b border-border">
                    <th className="text-left p-2 text-foreground">Prop</th>
                    <th className="text-left p-2 text-foreground">Tipo</th>
                    <th className="text-left p-2 text-foreground">Default</th>
                    <th className="text-left p-2 text-foreground">Descripci√≥n</th>
                  </tr>
                </thead>
                <tbody className="text-muted-foreground text-sm">
                  <tr className="border-b border-border">
                    <td className="p-2"><code className="px-2 py-1 bg-muted text-foreground rounded">open</code></td>
                    <td className="p-2">boolean</td>
                    <td className="p-2">-</td>
                    <td className="p-2">Estado de apertura del Popover (Popover prop)</td>
                  </tr>
                  <tr className="border-b border-border">
                    <td className="p-2"><code className="px-2 py-1 bg-muted text-foreground rounded">onOpenChange</code></td>
                    <td className="p-2">(open: boolean) =&gt; void</td>
                    <td className="p-2">-</td>
                    <td className="p-2">Callback cuando cambia el estado de apertura</td>
                  </tr>
                  <tr className="border-b border-border">
                    <td className="p-2"><code className="px-2 py-1 bg-muted text-foreground rounded">value</code></td>
                    <td className="p-2">string</td>
                    <td className="p-2">-</td>
                    <td className="p-2">Valor seleccionado actual del combobox</td>
                  </tr>
                  <tr className="border-b border-border">
                    <td className="p-2"><code className="px-2 py-1 bg-muted text-foreground rounded">onSelect</code></td>
                    <td className="p-2">(value: string) =&gt; void</td>
                    <td className="p-2">-</td>
                    <td className="p-2">Callback cuando se selecciona un item</td>
                  </tr>
                  <tr className="border-b border-border">
                    <td className="p-2"><code className="px-2 py-1 bg-muted text-foreground rounded">disabled</code></td>
                    <td className="p-2">boolean</td>
                    <td className="p-2">false</td>
                    <td className="p-2">Deshabilita el combobox</td>
                  </tr>
                </tbody>
              </table>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Casos de Uso</CardTitle>
              <CardDescription>Aplicaciones comunes del componente Combobox</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="grid md:grid-cols-3 gap-4">
                <div className="p-4 border border-border rounded-lg space-y-2">
                  <h4 className="font-medium text-foreground">üîç B√∫squeda con Autocompletado</h4>
                  <p className="text-sm text-muted-foreground">
                    Campo de b√∫squeda que sugiere resultados mientras el usuario escribe
                  </p>
                </div>
                <div className="p-4 border border-border rounded-lg space-y-2">
                  <h4 className="font-medium text-foreground">üì¶ Selector de Productos</h4>
                  <p className="text-sm text-muted-foreground">
                    Selecci√≥n de productos con b√∫squeda y filtrado en cat√°logos extensos
                  </p>
                </div>
                <div className="p-4 border border-border rounded-lg space-y-2">
                  <h4 className="font-medium text-foreground">üë• Selector de Usuarios</h4>
                  <p className="text-sm text-muted-foreground">
                    Asignar usuarios o miembros con b√∫squeda por nombre o email
                  </p>
                </div>
                <div className="p-4 border border-border rounded-lg space-y-2">
                  <h4 className="font-medium text-foreground">üåç Selector de Pa√≠s/Ciudad</h4>
                  <p className="text-sm text-muted-foreground">
                    Selecci√≥n de ubicaciones geogr√°ficas con b√∫squeda typeahead
                  </p>
                </div>
                <div className="p-4 border border-border rounded-lg space-y-2">
                  <h4 className="font-medium text-foreground">üè∑Ô∏è Tags y Categor√≠as</h4>
                  <p className="text-sm text-muted-foreground">
                    Agregar tags o categor√≠as con autocompletado de opciones existentes
                  </p>
                </div>
                <div className="p-4 border border-border rounded-lg space-y-2">
                  <h4 className="font-medium text-foreground">üíº Formularios Empresariales</h4>
                  <p className="text-sm text-muted-foreground">
                    Selecci√≥n de clientes, proveedores o departamentos en formularios
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Mejores Pr√°cticas</CardTitle>
              <CardDescription>Recomendaciones para uso efectivo del Combobox</CardDescription>
            </CardHeader>
            <CardContent>
              <ul className="space-y-2 text-sm text-muted-foreground">
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>Usa Combobox cuando tengas listas largas (&gt;10 items) que necesiten b√∫squeda</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>Muestra un checkmark (‚úì) en el item seleccionado para confirmaci√≥n visual clara</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>Cierra el popover autom√°ticamente despu√©s de seleccionar con setOpen(false)</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>Implementa CommandEmpty con mensaje √∫til cuando no hay resultados de b√∫squeda</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>Usa placeholders descriptivos como \"Search framework...\" para guiar al usuario</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>Combina Popover + Command para crear un combobox accesible y funcional</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>A√±ade <code className="px-1.5 py-0.5 bg-muted text-foreground rounded text-xs">role=\"combobox\"</code> y <code className="px-1.5 py-0.5 bg-muted text-foreground rounded text-xs">aria-expanded</code> para accesibilidad</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-primary mt-1">‚úì</span>
                  <span>Para listas muy extensas (&gt;1000 items), considera usar virtualizaci√≥n o carga lazy</span>
                </li>
              </ul>
            </CardContent>
          </Card>
        </>
      }
    />
  );
}